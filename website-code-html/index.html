<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F.E.M.S. - Evidence Management</title>
    <!-- 1. External Libraries (CDNs) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- 2. Custom CSS Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a; 
            color: #e2e8f0; 
        }
        
        .mono-font { font-family: 'JetBrains Mono', monospace; }
        
        /* Glassmorphism Panels */
        .glass-panel { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(148, 163, 184, 0.1); 
        }
        .glass-modal { 
            background: rgba(15, 23, 42, 0.95); 
            backdrop-filter: blur(15px); 
            border: 1px solid rgba(56, 189, 248, 0.2); 
        }
        
        /* Navigation Active State */
        .nav-item.active { 
            background: rgba(56, 189, 248, 0.1); 
            border-left: 3px solid #38bdf8; 
            color: #38bdf8; 
        }
        
        /* Form Inputs */
        .input-dark {
            background-color: #1e293b;
            border: 1px solid #334155;
            color: white;
            transition: all 0.3s;
        }
        .input-dark:focus {
            border-color: #38bdf8;
            outline: none;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.1);
        }

        /* Status Badges */
        .status-badge { font-size: 0.75rem; padding: 0.25rem 0.6rem; border-radius: 4px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
        .status-open { background: rgba(56, 189, 248, 0.1); color: #38bdf8; border: 1px solid rgba(56, 189, 248, 0.3); }
        .status-closed { background: rgba(34, 197, 94, 0.1); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.3); }
        .status-cold { background: rgba(148, 163, 184, 0.1); color: #94a3b8; border: 1px solid rgba(148, 163, 184, 0.3); }
        
        .table-row:hover { background-color: rgba(56, 189, 248, 0.05); cursor: pointer; }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <!-- SIDEBAR NAVIGATION -->
    <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col z-20">
        <div class="p-6 border-b border-slate-800 flex items-center gap-3">
            <div class="w-10 h-10 rounded bg-gradient-to-br from-blue-600 to-slate-800 flex items-center justify-center text-white font-bold shadow-lg shadow-blue-900/50">
                <i class="fas fa-fingerprint text-lg"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg tracking-wider text-slate-100">F.E.M.S.</h1>
                <p class="text-[10px] text-slate-500 uppercase tracking-widest">Forensic Admin</p>
            </div>
        </div>

        <nav class="flex-1 p-4 space-y-2">
            <button onclick="showView('dashboard')" id="nav-dashboard" class="nav-item active w-full text-left px-4 py-3 rounded hover:bg-slate-800 transition flex items-center gap-3">
                <i class="fas fa-chart-pie w-5"></i> Dashboard
            </button>
            <button onclick="showView('cases')" id="nav-cases" class="nav-item w-full text-left px-4 py-3 rounded hover:bg-slate-800 transition flex items-center gap-3">
                <i class="fas fa-briefcase w-5"></i> Case Files
            </button>
        </nav>

        <div class="p-4 border-t border-slate-800 text-slate-500 text-xs text-center font-mono">
            <p><i class="fas fa-wifi text-emerald-500 mr-2"></i>SECURE CONNECTION</p>
        </div>
    </aside>

    <!-- MAIN CONTENT AREA -->
    <main class="flex-1 flex flex-col relative overflow-hidden bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')]">
        
        <!-- Top Header -->
        <header class="h-16 border-b border-slate-800 bg-slate-900/90 backdrop-blur flex items-center justify-between px-6 z-10">
            <h2 id="page-title" class="text-xl font-semibold tracking-wide text-slate-100">Dashboard Overview</h2>
            <div class="flex items-center gap-4">
                <div class="text-right hidden md:block">
                    <div class="text-xs text-slate-400 uppercase">Logged in as</div>
                    <div class="text-sm font-bold text-blue-400">Admin_User_01</div>
                </div>
                <div class="w-10 h-10 rounded bg-slate-800 border border-slate-700 flex items-center justify-center">
                    <i class="fas fa-user-shield text-slate-300"></i>
                </div>
            </div>
        </header>

        <!-- View Container -->
        <div class="flex-1 overflow-y-auto p-8">
            
            <!-- VIEW 1: DASHBOARD -->
            <div id="view-dashboard" class="space-y-6">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="glass-panel p-6 rounded-lg border-l-4 border-blue-500">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Total Active Cases</p>
                                <h3 id="stat-total" class="text-4xl font-bold font-mono text-white">0</h3>
                            </div>
                            <div class="p-3 rounded bg-blue-500/10 text-blue-400"><i class="fas fa-folder-open text-xl"></i></div>
                        </div>
                    </div>
                    <div class="glass-panel p-6 rounded-lg border-l-4 border-emerald-500">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Solved / Closed</p>
                                <h3 id="stat-closed" class="text-4xl font-bold font-mono text-white">0</h3>
                            </div>
                            <div class="p-3 rounded bg-emerald-500/10 text-emerald-400"><i class="fas fa-check-circle text-xl"></i></div>
                        </div>
                    </div>
                    <div class="glass-panel p-6 rounded-lg border-l-4 border-purple-500">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Pending Evidence</p>
                                <h3 id="stat-evidence" class="text-4xl font-bold font-mono text-white">0</h3>
                            </div>
                            <div class="p-3 rounded bg-purple-500/10 text-purple-400"><i class="fas fa-box text-xl"></i></div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="glass-panel p-6 rounded-xl col-span-2">
                        <h3 class="font-semibold mb-6 text-sm uppercase text-slate-400 tracking-wider">Case Intake Analytics</h3>
                        <canvas id="mainChart" height="200"></canvas>
                    </div>
                    <div class="glass-panel p-6 rounded-xl">
                        <h3 class="font-semibold mb-6 text-sm uppercase text-slate-400 tracking-wider">Crime Type Distribution</h3>
                        <canvas id="pieChart" height="250"></canvas>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: CASES LIST -->
            <div id="view-cases" class="hidden space-y-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-2xl font-bold text-white">Case Database</h3>
                        <p class="text-slate-400 text-sm">View, manage, and update forensic files.</p>
                    </div>
                    <button onclick="openModal('new-case-modal')" class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-2.5 rounded shadow-lg shadow-blue-600/20 text-sm font-medium transition flex items-center gap-2">
                        <i class="fas fa-plus"></i> New Case Entry
                    </button>
                </div>

                <div class="glass-panel rounded-lg overflow-hidden border border-slate-700">
                    <table class="w-full text-left text-sm text-slate-400">
                        <thead class="bg-slate-900/80 text-xs uppercase font-bold text-slate-500 tracking-wider">
                            <tr>
                                <th class="px-6 py-4">Ref ID</th>
                                <th class="px-6 py-4">Case Title</th>
                                <th class="px-6 py-4">Lead Officer</th>
                                <th class="px-6 py-4">Date Filed</th>
                                <th class="px-6 py-4">Status</th>
                                <th class="px-6 py-4 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="cases-table-body" class="divide-y divide-slate-800">
                            <!-- JS Populates this -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>

    <!-- MODAL 1: ADD NEW CASE -->
    <div id="new-case-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="glass-modal rounded-xl w-full max-w-2xl p-8 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
                <h3 class="text-xl font-bold text-white flex items-center gap-2">
                    <i class="fas fa-folder-plus text-blue-500"></i> New Case Entry
                </h3>
                <button onclick="closeModal('new-case-modal')" class="text-slate-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <form id="case-form" class="space-y-5">
                <div class="grid grid-cols-2 gap-5">
                    <div>
                        <label class="block text-xs uppercase text-slate-500 mb-1 font-bold">Case Title</label>
                        <input type="text" id="input-title" class="input-dark w-full rounded p-2.5 text-sm" placeholder="e.g. Operation Nightfall" required>
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-slate-500 mb-1 font-bold">Crime Type</label>
                        <select id="input-type" class="input-dark w-full rounded p-2.5 text-sm">
                            <option>Homicide</option>
                            <option>Burglary</option>
                            <option>Cybercrime</option>
                            <option>Narcotics</option>
                            <option>Fraud</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-5">
                    <div>
                        <label class="block text-xs uppercase text-slate-500 mb-1 font-bold">Lead Detective</label>
                        <input type="text" id="input-lead" class="input-dark w-full rounded p-2.5 text-sm" value="Det. ">
                    </div>
                    <div>
                        <label class="block text-xs uppercase text-slate-500 mb-1 font-bold">Current Status</label>
                        <select id="input-status" class="input-dark w-full rounded p-2.5 text-sm">
                            <option value="Open">Open Investigation</option>
                            <option value="Closed">Closed / Solved</option>
                            <option value="Cold">Cold Case</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-xs uppercase text-slate-500 mb-1 font-bold">Case Description</label>
                    <textarea id="input-desc" class="input-dark w-full rounded p-3 text-sm h-32 font-mono" placeholder="Enter detailed description..."></textarea>
                </div>
                <div>
                    <label class="block text-xs uppercase text-slate-500 mb-1 font-bold">Evidence Collected</label>
                    <textarea id="input-evidence" class="input-dark w-full rounded p-3 text-sm h-24 font-mono" placeholder="- Item 1: Fingerprints..."></textarea>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('new-case-modal')" class="px-5 py-2 text-sm text-slate-400 hover:text-white transition">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-sm font-bold transition shadow-lg shadow-blue-600/20">SAVE RECORD</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL 2: VIEW DETAILS -->
    <div id="view-case-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="glass-modal rounded-xl w-full max-w-2xl shadow-2xl overflow-y-auto max-h-[90vh] border-t-4 border-blue-500">
            <div class="p-8 pb-0 flex justify-between items-start">
                <div>
                    <span id="view-id" class="font-mono text-blue-400 text-sm block mb-1">CASE #000</span>
                    <h2 id="view-title" class="text-2xl font-bold text-white">Case Title</h2>
                    <div class="flex gap-4 mt-2 text-xs text-slate-400">
                        <span id="view-type"><i class="fas fa-tag mr-1"></i> TYPE</span>
                        <span id="view-date"><i class="fas fa-calendar mr-1"></i> DATE</span>
                        <span id="view-lead"><i class="fas fa-user-secret mr-1"></i> LEAD</span>
                    </div>
                </div>
                <div id="view-status-badge" class="px-3 py-1 rounded bg-blue-500/20 text-blue-400 border border-blue-500/50 text-xs font-bold uppercase">OPEN</div>
            </div>
            <div class="p-8 space-y-6">
                <div class="bg-slate-900/50 p-4 rounded border border-slate-700">
                    <h4 class="text-xs uppercase text-slate-500 font-bold mb-2 border-b border-slate-800 pb-2">Description</h4>
                    <p id="view-desc" class="text-sm text-slate-300 font-mono whitespace-pre-wrap">...</p>
                </div>
                <div class="bg-slate-900/50 p-4 rounded border border-slate-700">
                    <h4 class="text-xs uppercase text-slate-500 font-bold mb-2 border-b border-slate-800 pb-2">Evidence Log</h4>
                    <p id="view-evidence" class="text-sm text-emerald-400 font-mono whitespace-pre-wrap">...</p>
                </div>
            </div>
            <div class="p-4 bg-slate-900/80 border-t border-slate-800 flex justify-end">
                <button onclick="closeModal('view-case-modal')" class="px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded text-sm font-medium transition">Close File</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 1. DATA MANAGEMENT (LocalStorage) ---
        let casesData = JSON.parse(localStorage.getItem('fems_db')) || [
            { id: 'CS-2024-001', title: 'Downtown Jewelry Heist', lead: 'Det. Miller', date: '2024-11-02', status: 'Open', type: 'Burglary', desc: 'Suspects entered through rear vent.', evidence: '- Crowbar\n- CCTV footage' },
            { id: 'CS-2024-002', title: 'Server Farm Hack', lead: 'Agt. Smith', date: '2024-10-15', status: 'Closed', type: 'Cybercrime', desc: 'Unauthorized access detected.', evidence: '- Server Logs' }
        ];

        function saveData() {
            localStorage.setItem('fems_db', JSON.stringify(casesData));
            updateDashboard();
            renderTable();
        }

        // --- 2. NAVIGATION ---
        function showView(viewId) {
            ['dashboard', 'cases'].forEach(id => {
                document.getElementById(`view-${id}`).classList.add('hidden');
                document.getElementById(`nav-${id}`).classList.remove('active');
            });
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            document.getElementById(`nav-${viewId}`).classList.add('active');
            document.getElementById('page-title').textContent = viewId === 'dashboard' ? 'Dashboard Overview' : 'Case Database Registry';
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        // --- 3. CORE FUNCTIONS ---
        function renderTable() {
            const tbody = document.getElementById('cases-table-body');
            tbody.innerHTML = '';
            casesData.forEach((c, index) => {
                const statusStyle = c.status === 'Open' ? 'status-open' : (c.status === 'Closed' ? 'status-closed' : 'status-cold');
                const row = `
                    <tr class="table-row group transition border-b border-slate-800 last:border-0" onclick="viewCaseDetails(${index})">
                        <td class="px-6 py-4 font-mono text-blue-400 font-bold">${c.id}</td>
                        <td class="px-6 py-4"><div class="font-medium text-slate-200">${c.title}</div><div class="text-xs text-slate-500">${c.type}</div></td>
                        <td class="px-6 py-4 text-slate-400">${c.lead}</td>
                        <td class="px-6 py-4 font-mono text-xs text-slate-500">${c.date}</td>
                        <td class="px-6 py-4"><span class="status-badge ${statusStyle}">${c.status}</span></td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="event.stopPropagation(); deleteCase(${index})" class="p-2 text-slate-600 hover:text-red-400"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
                tbody.innerHTML += row;
            });
        }

        function viewCaseDetails(index) {
            const c = casesData[index];
            document.getElementById('view-id').innerText = c.id;
            document.getElementById('view-title').innerText = c.title;
            document.getElementById('view-type').innerHTML = `<i class="fas fa-tag mr-1"></i> ${c.type}`;
            document.getElementById('view-lead').innerHTML = `<i class="fas fa-user-secret mr-1"></i> ${c.lead}`;
            document.getElementById('view-date').innerHTML = `<i class="fas fa-calendar mr-1"></i> ${c.date}`;
            document.getElementById('view-desc').innerText = c.desc || "No description.";
            document.getElementById('view-evidence').innerText = c.evidence || "No evidence.";
            
            const badge = document.getElementById('view-status-badge');
            badge.innerText = c.status;
            badge.className = `px-3 py-1 rounded border text-xs font-bold uppercase ${c.status === 'Open' ? 'bg-blue-500/20 text-blue-400 border-blue-500/50' : (c.status === 'Closed' ? 'bg-emerald-500/20 text-emerald-400 border-emerald-500/50' : 'bg-slate-500/20 text-slate-400 border-slate-500/50')}`;
            openModal('view-case-modal');
        }

        document.getElementById('case-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const newCase = {
                id: `CS-2024-${String(casesData.length + 1).padStart(3, '0')}`,
                title: document.getElementById('input-title').value,
                type: document.getElementById('input-type').value,
                lead: document.getElementById('input-lead').value,
                status: document.getElementById('input-status').value,
                desc: document.getElementById('input-desc').value,
                evidence: document.getElementById('input-evidence').value,
                date: new Date().toISOString().split('T')[0]
            };
            casesData.unshift(newCase);
            saveData();
            closeModal('new-case-modal');
            e.target.reset();
        });

        function deleteCase(index) {
            if(confirm("Confirm deletion?")) {
                casesData.splice(index, 1);
                saveData();
            }
        }

        // --- 4. CHARTS ---
        function updateDashboard() {
            // Update Text Stats
            document.getElementById('stat-total').innerText = casesData.filter(c => c.status === 'Open').length;
            document.getElementById('stat-closed').innerText = casesData.filter(c => c.status === 'Closed').length;
            let evCount = 0;
            casesData.forEach(c => { if(c.evidence) evCount += c.evidence.split('\n').length; });
            document.getElementById('stat-evidence').innerText = evCount;

            // Update Bar Chart
            if(window.mainChart && window.mainChart.data) {
                window.mainChart.data.datasets[0].data = [
                    casesData.filter(c => c.status === 'Open').length,
                    casesData.filter(c => c.status === 'Closed').length,
                    casesData.filter(c => c.status === 'Cold').length
                ];
                window.mainChart.update();
            }

            // Update Pie Chart
            if(window.pieChart && window.pieChart.data) {
                const typeCounts = { 'Homicide': 0, 'Burglary': 0, 'Cybercrime': 0, 'Narcotics': 0, 'Fraud': 0 };
                casesData.forEach(c => {
                    // Normalize type (in case of legacy data)
                    let t = c.type;
                    if(t === 'Cyber') t = 'Cybercrime'; 
                    if(typeCounts.hasOwnProperty(t)) typeCounts[t]++;
                });
                
                window.pieChart.data.datasets[0].data = [
                    typeCounts['Homicide'],
                    typeCounts['Burglary'],
                    typeCounts['Cybercrime'],
                    typeCounts['Narcotics'],
                    typeCounts['Fraud']
                ];
                window.pieChart.update();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderTable();

            // Destroy existing instances if any (safety)
            if(window.mainChart instanceof Chart) window.mainChart.destroy();
            if(window.pieChart instanceof Chart) window.pieChart.destroy();

            // Init Bar Chart
            const ctx1 = document.getElementById('mainChart').getContext('2d');
            window.mainChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Active', 'Closed', 'Cold'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#3b82f6', '#10b981', '#64748b'],
                        barThickness: 40
                    }]
                },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#334155' } }, x: { grid: { display: false } } } }
            });

            // Init Pie Chart
            const ctx2 = document.getElementById('pieChart').getContext('2d');
            window.pieChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Homicide', 'Burglary', 'Cybercrime', 'Narcotics', 'Fraud'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981', '#8b5cf6'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, plugins: { legend: { position: 'right', labels: { color: '#94a3b8' } } } }
            });

            updateDashboard();
        });
    </script>
</body>
</html>